package com.Mirai.impl.module.exploit;

import com.Mirai.api.module.Category;
import com.Mirai.api.module.Module;
import com.Mirai.api.util.LoggerUtil;
import com.Mirai.impl.event.PacketSendEvent;
import java.util.LinkedList;
import java.util.Queue;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class Blink extends Module {
   private final Queue packetQueue = new LinkedList();
   private EntityOtherPlayerMP player;

   public Blink(String name, String description, Category category) {
      super(name, description, category);
   }

   @SubscribeEvent
   public void onPacketSend(PacketSendEvent event) {
      if (!this.nullCheck()) {
         if (this.isEnabled() && event.getPacket() instanceof CPacketPlayer) {
            event.setCanceled(true);
            this.packetQueue.add((CPacketPlayer)event.getPacket());
         }

      }
   }

   public void onEnable() {
      this.player = new EntityOtherPlayerMP(this.mc.world, this.mc.getSession().getProfile());
      this.player.copyLocationAndAnglesFrom(this.mc.player);
      this.player.rotationYawHead = this.mc.player.rotationYawHead;
      this.mc.world.addEntityToWorld(-100, this.player);
      LoggerUtil.sendMessage("Blink ON");
   }

   public void onDisable() {
      while(!this.packetQueue.isEmpty()) {
         this.mc.player.connection.sendPacket((Packet)this.packetQueue.poll());
      }

      if (this.mc.player != null) {
         this.mc.world.removeEntityFromWorld(-100);
         this.player = null;
      }

      LoggerUtil.sendMessage("Blink OFF");
   }
}
