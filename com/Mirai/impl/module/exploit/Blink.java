package com.Mirai.impl.module.exploit;

import com.Mirai.api.module.Category;
import com.Mirai.api.module.Module;
import com.Mirai.api.util.LoggerUtil;
import com.Mirai.impl.event.PacketSendEvent;
import java.util.LinkedList;
import java.util.Queue;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class Blink extends Module {
   private final Queue packetQueue = new LinkedList();
   private EntityOtherPlayerMP player;

   public Blink(String name, String description, Category category) {
      super(name, description, category);
   }

   @SubscribeEvent
   public void onPacketSend(PacketSendEvent event) {
      if (!this.nullCheck()) {
         if (this.isEnabled() && event.getPacket() instanceof CPacketPlayer) {
            event.setCanceled(true);
            this.packetQueue.add((CPacketPlayer)event.getPacket());
         }

      }
   }

   public void onEnable() {
      this.player = new EntityOtherPlayerMP(this.mc.field_71441_e, this.mc.func_110432_I().func_148256_e());
      this.player.func_82149_j(this.mc.field_71439_g);
      this.player.field_70759_as = this.mc.field_71439_g.field_70759_as;
      this.mc.field_71441_e.func_73027_a(-100, this.player);
      LoggerUtil.sendMessage("Blink ON");
   }

   public void onDisable() {
      while(!this.packetQueue.isEmpty()) {
         this.mc.field_71439_g.field_71174_a.func_147297_a((Packet)this.packetQueue.poll());
      }

      if (this.mc.field_71439_g != null) {
         this.mc.field_71441_e.func_73028_b(-100);
         this.player = null;
      }

      LoggerUtil.sendMessage("Blink OFF");
   }
}
